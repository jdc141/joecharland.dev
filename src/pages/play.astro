---
import Layout from "../components/Layout.astro";
---

<Layout title="Arctic Adventure - Joe Charland">
  <section class="text-center py-8">
    <div class="animate-fade-in">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 gradient-text">
        Arctic Adventure üêß
      </h1>
      <p class="text-gray-400 mb-6">
        A mini penguin jumping game!
      </p>
      
      <!-- Game -->
      <div class="max-w-2xl mx-auto mb-4">
        <div class="bg-gray-800/50 border border-gray-700 rounded-lg p-6 relative">
          <div class="mb-4 flex justify-between items-center text-xs md:text-sm flex-wrap gap-2">
            <p class="text-gray-400">
              <span class="hidden md:inline">Press <kbd class="px-2 py-1 bg-gray-700 rounded text-xs">SPACE</kbd></span>
              <span class="md:hidden">Tap</span> to jump
            </p>
            <div class="flex gap-3 text-gray-400">
              <span>Score: <span id="score" class="text-white font-semibold">0</span></span>
              <span>üêü <span id="fishCount" class="text-blue-300 font-semibold">0</span></span>
              <span>‚≠ê <span id="starCount" class="text-yellow-300 font-semibold">0</span></span>
            </div>
          </div>
          <div class="relative">
            <canvas id="gameCanvas" width="600" height="200" class="w-full bg-gray-900 rounded cursor-pointer touch-none select-none"></canvas>
            
            <!-- Instructions Overlay -->
            <div id="instructions" class="absolute inset-0 bg-gray-900/95 rounded flex items-center justify-center cursor-pointer">
              <div class="text-center px-3 md:px-6 py-2">
                <h3 class="text-lg md:text-xl font-bold mb-3 text-blue-400">How to Play</h3>
                <div class="space-y-1.5 md:space-y-2 text-left max-w-xs mx-auto mb-3 text-xs md:text-sm">
                  <div class="flex items-center gap-2">
                    <span class="text-xl md:text-2xl">üêß</span>
                    <span class="text-gray-300 text-xs md:text-sm">You're the penguin</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xl md:text-2xl">üêª‚Äç‚ùÑÔ∏è</span>
                    <span class="text-gray-300 text-xs md:text-sm">Avoid polar bears</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xl md:text-2xl">üêü</span>
                    <span class="text-gray-300 text-xs md:text-sm">Fish = super jump</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xl md:text-2xl">‚≠ê</span>
                    <span class="text-gray-300 text-xs md:text-sm">Stars = +5 points</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <kbd class="px-2 py-0.5 bg-gray-700 rounded text-xs hidden md:inline-block">SPACE</kbd>
                    <span class="md:hidden text-xl">üëÜ</span>
                    <span class="text-gray-300 text-xs md:text-sm"><span class="hidden md:inline">SPACE</span><span class="md:hidden">Tap</span> to jump</span>
                  </div>
                </div>
                <p class="text-blue-400 animate-pulse text-xs md:text-sm">
                  <span class="hidden md:inline">Press SPACE</span>
                  <span class="md:hidden">Tap</span> to start!
                </p>
              </div>
            </div>
          </div>
          <div id="gameOver" class="mt-4 hidden">
            <p class="text-sm text-red-400 mb-4">Game Over! Press SPACE to restart</p>
            <div class="bg-blue-600/10 border border-blue-500/30 rounded-lg p-4 mt-4">
              <p class="text-gray-300 mb-3">
                Seems like you're enjoying this game... ü§î
              </p>
              <p class="text-gray-300 mb-4">
                Maybe you'd enjoy <strong class="text-white">hiring me</strong> too?
              </p>
              <a href="/resume" 
                 class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-500 px-5 py-2 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 text-sm">
                <i class="fas fa-user-tie"></i>
                View Resume
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="flex gap-4 justify-center flex-wrap mt-2">
        <a href="/" 
           class="border border-gray-600 hover:bg-gray-700 px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105">
          <i class="fas fa-home mr-2"></i>
          Back Home
        </a>
      </div>
    </div>
  </section>
</Layout>

<style>
  .gradient-text {
    background: linear-gradient(90deg, #60a5fa, #a78bfa, #f472b6, #60a5fa);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-flow 4s linear infinite;
  }

  @keyframes gradient-flow {
    to { background-position: 200% center; }
  }

  .animate-fade-in {
    animation: fadeIn 0.8s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  kbd {
    font-family: monospace;
    font-size: 0.9em;
  }
</style>

<script>
  const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;
  const ctx = canvas.getContext('2d')!;
  const scoreEl = document.getElementById('score')!;
  const fishCountEl = document.getElementById('fishCount')!;
  const starCountEl = document.getElementById('starCount')!;
  const highScoreEl = document.getElementById('highScore')!;
  const gameOverEl = document.getElementById('gameOver')!;
  const instructionsEl = document.getElementById('instructions')!;
  const gameOverCTA = document.getElementById('gameOverCTA')!;

  // Load high score from localStorage
  let highScore = parseInt(localStorage.getItem('penguinHighScore') || '0');
  highScoreEl.textContent = highScore.toString();

  // Game state
  let score = 0;
  let fishCollected = 0;
  let starsCollected = 0;
  let gameOver = false;
  let gameStarted = false;

  // Player (penguin character)
  const player = {
    x: 50,
    y: 150,
    width: 30,
    height: 35,
    velocityY: 0,
    jumping: false
  };

  // Game objects
  let obstacles: Array<{ x: number; width: number; height: number }> = [];
  let powerUps: Array<{ x: number; y: number; width: number; height: number }> = [];
  let platforms: Array<{ x: number; y: number; width: number; height: number }> = [];
  let stars: Array<{ x: number; y: number; width: number; height: number }> = [];
  let frameCount = 0;
  let nextObstacleFrame = 150; // Random spawn timing
  const gravity = 0.35; // Reduced from 0.5 for smoother falling
  let jumpPower = -10;
  const normalJumpPower = -10;
  const superJumpPower = -14;
  const groundY = 170;
  let powerUpActive = false;
  let powerUpTimer = 0;

  // Controls
  // Jump function
  function jump() {
    if (!gameStarted) {
      // Hide instructions and start game
      instructionsEl.classList.add('hidden');
      gameStarted = true;
      gameLoop();
    } else if (gameOver) {
      resetGame();
    } else if (!player.jumping) {
      player.velocityY = jumpPower;
      player.jumping = true;
    }
  }

  // Keyboard controls
  document.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
      e.preventDefault();
      jump();
    }
  });

  // Touch/Click controls for mobile (canvas)
  canvas.addEventListener('click', (e) => {
    e.preventDefault();
    jump();
  });

  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    jump();
  });

  // Make instructions overlay tappable too
  if (instructionsEl) {
    instructionsEl.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      console.log('Overlay clicked!');
      jump();
    }, true); // Use capture phase

    instructionsEl.addEventListener('touchstart', (e) => {
      e.preventDefault();
      e.stopPropagation();
      console.log('Overlay touched!');
      jump();
    }, true); // Use capture phase
  }

  function resetGame() {
    score = 0;
    fishCollected = 0;
    starsCollected = 0;
    gameOver = false;
    gameStarted = true;
    obstacles = [];
    powerUps = [];
    platforms = [];
    stars = [];
    player.y = groundY - player.height;
    player.velocityY = 0;
    player.jumping = false;
    frameCount = 0;
    nextObstacleFrame = 150;
    powerUpActive = false;
    powerUpTimer = 0;
    jumpPower = normalJumpPower;
    scoreEl.textContent = '0';
    fishCountEl.textContent = '0';
    starCountEl.textContent = '0';
    gameOverEl.classList.add('hidden');
    instructionsEl.classList.add('hidden');
    gameOverCTA.classList.add('hidden');
    gameLoop();
  }

  function gameLoop() {
    if (gameOver || !gameStarted) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Update player
    player.velocityY += gravity;
    player.y += player.velocityY;

    if (player.y >= groundY - player.height) {
      player.y = groundY - player.height;
      player.velocityY = 0;
      player.jumping = false;
    }

    // Draw player (penguin)
    drawPenguin(player.x, player.y);

    // Spawn obstacles and power-ups with random timing
    frameCount++;
    
    // Random obstacle spawning
    if (frameCount >= nextObstacleFrame) {
      obstacles.push({
        x: canvas.width,
        width: 35,
        height: 30
      });
      nextObstacleFrame = frameCount + Math.floor(Math.random() * 100 + 100); // 100-200 frames
    }
    
    // Spawn fish occasionally
    if (frameCount % 250 === 0) {
      powerUps.push({
        x: canvas.width,
        y: groundY - 80,
        width: 20,
        height: 15
      });
    }
    
    // Spawn platforms every so often
    if (frameCount % 300 === 0 && Math.random() > 0.5) {
      platforms.push({
        x: canvas.width,
        y: groundY - 60,
        width: 80,
        height: 10
      });
    }
    
    // Spawn stars after score reaches 10
    if (score >= 10 && frameCount % 350 === 0) {
      stars.push({
        x: canvas.width,
        y: groundY - 100,
        width: 20,
        height: 20
      });
    }
    
    if (powerUpActive) {
      powerUpTimer--;
      if (powerUpTimer <= 0) {
        powerUpActive = false;
        jumpPower = normalJumpPower;
      }
    }

    // Update and draw obstacles (polar bears)
    obstacles = obstacles.filter(obs => {
      obs.x -= 2; // Slowed down from 3 to 2 for better gameplay
      drawPolarBear(obs.x, groundY - obs.height);

      if (
        player.x < obs.x + obs.width - 5 &&
        player.x + player.width > obs.x + 5 &&
        player.y + player.height > groundY - obs.height + 5
      ) {
        gameOver = true;
        gameOverEl.classList.remove('hidden');
        
        // Update high score
        if (score > highScore) {
          highScore = score;
          highScoreEl.textContent = highScore.toString();
          localStorage.setItem('penguinHighScore', highScore.toString());
        }
        return false;
      }

      if (obs.x + obs.width < 0) {
        score++;
        scoreEl.textContent = score.toString();
        return false;
      }

      return obs.x > -obs.width;
    });
    
    // Update and draw power-ups (fish)
    powerUps = powerUps.filter(fish => {
      fish.x -= 2; // Match obstacle speed
      drawFish(fish.x, fish.y);
      
      if (
        player.x < fish.x + fish.width &&
        player.x + player.width > fish.x &&
        player.y < fish.y + fish.height &&
        player.y + player.height > fish.y
      ) {
        powerUpActive = true;
        powerUpTimer = 180;
        jumpPower = superJumpPower;
        fishCollected++;
        fishCountEl.textContent = fishCollected.toString();
        return false;
      }
      
      return fish.x > -fish.width;
    });

    // Update and draw platforms
    platforms = platforms.filter(plat => {
      plat.x -= 2;
      
      // Draw ice platform with gradient
      const gradient = ctx.createLinearGradient(plat.x, plat.y, plat.x, plat.y + plat.height);
      gradient.addColorStop(0, '#e0f2fe'); // light blue
      gradient.addColorStop(0.5, '#bae6fd'); // lighter blue
      gradient.addColorStop(1, '#7dd3fc'); // sky blue
      ctx.fillStyle = gradient;
      ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
      
      // Add sparkle effect
      ctx.strokeStyle = '#f0f9ff';
      ctx.lineWidth = 1;
      ctx.strokeRect(plat.x, plat.y, plat.width, plat.height);
      
      // Platform collision (landing on top)
      if (
        player.x < plat.x + plat.width &&
        player.x + player.width > plat.x &&
        player.y + player.height >= plat.y &&
        player.y + player.height <= plat.y + plat.height + 5 &&
        player.velocityY >= 0
      ) {
        player.y = plat.y - player.height;
        player.velocityY = 0;
        player.jumping = false;
      }
      
      return plat.x > -plat.width;
    });

    // Update and draw stars
    stars = stars.filter(star => {
      star.x -= 2;
      
      // Draw star
      drawStar(star.x + star.width / 2, star.y + star.height / 2, 10);
      
      // Collision detection for star collection
      if (
        player.x < star.x + star.width &&
        player.x + player.width > star.x &&
        player.y < star.y + star.height &&
        player.y + player.height > star.y
      ) {
        starsCollected++;
        starCountEl.textContent = starsCollected.toString();
        score += 5; // Bonus points for stars
        scoreEl.textContent = score.toString();
        return false;
      }
      
      return star.x > -star.width;
    });

    // Draw ground line
    ctx.strokeStyle = '#4b5563';
    ctx.beginPath();
    ctx.moveTo(0, groundY);
    ctx.lineTo(canvas.width, groundY);
    ctx.stroke();

    if (!gameOver) {
      requestAnimationFrame(gameLoop);
    }
  }

  // Draw functions (same as 404 page)
  function drawPolarBear(x: number, y: number) {
    ctx.fillStyle = '#f3f4f6';
    ctx.beginPath();
    ctx.ellipse(x + 17, y + 18, 15, 12, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(x + 17, y + 8, 10, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(x + 11, y + 3, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(x + 23, y + 3, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#000000';
    ctx.beginPath();
    ctx.arc(x + 14, y + 7, 1.5, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(x + 20, y + 7, 1.5, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(x + 17, y + 11, 2, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#f3f4f6';
    ctx.fillRect(x + 8, y + 25, 6, 5);
    ctx.fillRect(x + 20, y + 25, 6, 5);
  }
  
  function drawFish(x: number, y: number) {
    ctx.fillStyle = '#fb923c';
    ctx.beginPath();
    ctx.ellipse(x + 10, y + 7, 8, 5, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(x + 2, y + 7);
    ctx.lineTo(x, y + 3);
    ctx.lineTo(x, y + 11);
    ctx.closePath();
    ctx.fill();
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.arc(x + 14, y + 6, 2, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#000000';
    ctx.beginPath();
    ctx.arc(x + 14, y + 6, 1, 0, Math.PI * 2);
    ctx.fill();
  }

  function drawPenguin(x: number, y: number) {
    const centerX = x + player.width / 2;
    ctx.fillStyle = '#1f2937';
    ctx.beginPath();
    ctx.ellipse(centerX, y + 20, 12, 15, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.ellipse(centerX, y + 22, 8, 12, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#1f2937';
    ctx.beginPath();
    ctx.arc(centerX, y + 8, 8, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.arc(centerX - 3, y + 7, 2, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(centerX + 3, y + 7, 2, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#000000';
    ctx.beginPath();
    ctx.arc(centerX - 3, y + 7, 1, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(centerX + 3, y + 7, 1, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#f97316';
    ctx.beginPath();
    ctx.moveTo(centerX, y + 10);
    ctx.lineTo(centerX - 3, y + 12);
    ctx.lineTo(centerX + 3, y + 12);
    ctx.closePath();
    ctx.fill();
    ctx.fillStyle = '#f97316';
    ctx.beginPath();
    ctx.ellipse(centerX - 5, y + 34, 3, 2, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.ellipse(centerX + 5, y + 34, 3, 2, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#1f2937';
    ctx.beginPath();
    ctx.ellipse(centerX - 11, y + 18, 3, 8, -0.3, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.ellipse(centerX + 11, y + 18, 3, 8, 0.3, 0, Math.PI * 2);
    ctx.fill();
  }

  // Initial draw
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPenguin(player.x, groundY - player.height);
  ctx.strokeStyle = '#4b5563';
  ctx.beginPath();
  ctx.moveTo(0, groundY);
  ctx.lineTo(canvas.width, groundY);
  ctx.stroke();

  // Draw star helper function
  function drawStar(cx: number, cy: number, radius: number) {
    const spikes = 5;
    const outerRadius = radius;
    const innerRadius = radius / 2;
    let rot = Math.PI / 2 * 3;
    const step = Math.PI / spikes;
    
    ctx.fillStyle = '#fbbf24';
    ctx.strokeStyle = '#f59e0b';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(cx, cy - outerRadius);
    
    for (let i = 0; i < spikes; i++) {
      let x = cx + Math.cos(rot) * outerRadius;
      let y = cy + Math.sin(rot) * outerRadius;
      ctx.lineTo(x, y);
      rot += step;
      
      x = cx + Math.cos(rot) * innerRadius;
      y = cy + Math.sin(rot) * innerRadius;
      ctx.lineTo(x, y);
      rot += step;
    }
    
    ctx.lineTo(cx, cy - outerRadius);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
  }
</script>

