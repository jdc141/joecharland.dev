---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from "../components/Layout.astro";
import ProjectCard from "../components/ProjectCard.astro";

const allProjects = await getCollection('projects');

// Separate real projects from the coming-soon placeholder
const realProjects = allProjects.filter(p => p.slug !== 'coming-soon');
const comingSoonProject = allProjects.find(p => p.slug === 'coming-soon');

// Show coming-soon card if there are fewer than 2 real projects
const projectsToShow = realProjects.length < 2 
  ? [...realProjects, ...(comingSoonProject ? [comingSoonProject] : [])]
  : realProjects;

// Sort projects by order
const sortedProjects = projectsToShow.sort((a, b) => {
  const orderA = a.data.order || 999;
  const orderB = b.data.order || 999;
  return orderA - orderB;
});
---

<Layout title="Projects - Joe Charland">
  <div class="mb-12">
    <!-- Back button -->
    <a href="/" class="inline-flex items-center text-blue-400 hover:text-blue-300 mb-6 transition group">
      <i class="fas fa-arrow-left mr-2 arrow-wave"></i>
      Back to Home
    </a>
    <h1 class="text-3xl md:text-4xl font-bold mb-4">Projects</h1>
    <p class="text-gray-400">
      A collection of my software engineering projects, showcasing work in full-stack development, 
      course projects, 
      and random side projects that I'm tinkering with in my free time.
    </p>
  </div>
  
  <div class="grid sm:grid-cols-2 gap-6">
    {sortedProjects.map(p => {
      // Override title for coming-soon based on number of real projects
      const cardData = p.slug === 'coming-soon' 
        ? { ...p.data, title: realProjects.length > 0 ? "More Projects Coming Soon" : "Projects Coming Soon" }
        : p.data;
      
      return <ProjectCard {...cardData} slug={p.slug} />;
    })}
  </div>
</Layout>